<ep-app-header [title]="request?.name || 'Execute Request'">
  <div header-actions>
    @if (!executing && executionResult?.status === 'success') {
      <ep-button variant="primary" size="small" (click)="onViewOutput()">
        <span class="material-icons">visibility</span>
        View Output
      </ep-button>
    }
  </div>
</ep-app-header>

<main class="request-execute">
  @if (!request) {
    <div class="request-execute__loading">Loading...</div>
  } @else {
    <div class="request-execute__header">
      <div>
        <h1 class="request-execute__title">{{ executing ? 'Executing Request' : 'Execution Complete' }}</h1>
        <p class="request-execute__subtitle">{{ request.name }}</p>
      </div>
      @if (executionResult) {
        <ep-status-indicator
          [status]="executionResult.status === 'success' ? 'success' : 'error'"
          [text]="executionResult.status === 'success' ? 'Success' : 'Failed'"
        />
      }
    </div>

    <ep-card class="request-execute__card">
      @if (executing) {
        <div class="request-execute__progress">
          <div class="request-execute__progress-header">
            <h3 class="request-execute__section-title">Progress</h3>
            <span class="request-execute__progress-percentage">{{ executionProgress }}%</span>
          </div>
          
          <div class="request-execute__progress-bar">
            <div 
              class="request-execute__progress-fill" 
              [style.width.%]="executionProgress"
            ></div>
          </div>

          @if (currentStep) {
            <div class="request-execute__current-step">
              <span class="material-icons request-execute__spinner">sync</span>
              <span>{{ currentStep }}</span>
            </div>
          }
        </div>
      } @else if (executionResult) {
        <div class="request-execute__result">
          <div class="request-execute__result-header">
            @if (executionResult.status === 'success') {
              <span class="material-icons request-execute__result-icon request-execute__result-icon--success">check_circle</span>
              <h3>Execution Completed Successfully</h3>
            } @else {
              <span class="material-icons request-execute__result-icon request-execute__result-icon--error">error</span>
              <h3>Execution Failed</h3>
            }
          </div>

          @if (executionResult.status === 'success') {
            <div class="request-execute__details">
              @if (executionResult.outputPath) {
                <div class="request-execute__detail">
                  <span class="request-execute__detail-label">Output Location:</span>
                  <span class="request-execute__detail-value">{{ executionResult.outputPath }}</span>
                </div>
              }
              @if (executionResult.generatedFiles && executionResult.generatedFiles.length > 0) {
                <div class="request-execute__detail">
                  <span class="request-execute__detail-label">Files Generated:</span>
                  <span class="request-execute__detail-value">{{ executionResult.generatedFiles.length }} files</span>
                </div>
              }
              @if (executionResult.executionTime) {
                <div class="request-execute__detail">
                  <span class="request-execute__detail-label">Execution Time:</span>
                  <span class="request-execute__detail-value">{{ executionResult.executionTime / 1000 }}s</span>
                </div>
              }
            </div>

            @if (executionResult.warnings && executionResult.warnings.length > 0) {
              <div class="request-execute__warnings">
                <h4 class="request-execute__warnings-title">
                  <span class="material-icons">warning</span>
                  Warnings ({{ executionResult.warnings.length }})
                </h4>
                <ul class="request-execute__warnings-list">
                  @for (warning of executionResult.warnings; track warning) {
                    <li>{{ warning }}</li>
                  }
                </ul>
              </div>
            }
          } @else {
            @if (executionResult.errors && executionResult.errors.length > 0) {
              <div class="request-execute__errors">
                <h4 class="request-execute__errors-title">Errors:</h4>
                <ul class="request-execute__errors-list">
                  @for (error of executionResult.errors; track error) {
                    <li>{{ error }}</li>
                  }
                </ul>
              </div>
            }
          }
        </div>
      }
    </ep-card>

    <ep-card class="request-execute__card">
      <h3 class="request-execute__section-title">Execution Log</h3>
      <div class="request-execute__logs">
        @for (log of logs; track $index) {
          <div class="request-execute__log-entry">{{ log }}</div>
        }
        @if (logs.length === 0) {
          <div class="request-execute__no-logs">No logs yet...</div>
        }
      </div>
    </ep-card>

    <div class="request-execute__actions">
      @if (!executing) {
        <ep-button variant="secondary" (click)="onBackToRequest()">
          Back to Request
        </ep-button>
        <ep-button variant="secondary" (click)="onBackToList()">
          Back to List
        </ep-button>
        @if (executionResult?.status === 'success') {
          <ep-button variant="primary" (click)="onViewOutput()">
            <span class="material-icons">visibility</span>
            View Output
          </ep-button>
        }
      }
    </div>
  }
</main>
