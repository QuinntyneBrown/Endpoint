<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2024-01-10T00:00:00.000Z" agent="Mozilla/5.0" version="22.1.0" type="device">
  <diagram name="Event-Driven Message Flow" id="event-driven-flow">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Design 2: Event-Driven Message Flow" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="500" height="40" as="geometry" />
        </mxCell>

        <!-- Order Service Box -->
        <mxCell id="orderService" value="Order Service" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="280" height="280" as="geometry" />
        </mxCell>

        <mxCell id="orderAggregate" value="Order Aggregate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="orderService">
          <mxGeometry x="20" y="50" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="orderDomainEvents" value="Domain Events&#xa;- OrderCreated&#xa;- OrderSubmitted&#xa;- OrderCompleted" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" vertex="1" parent="orderService">
          <mxGeometry x="150" y="50" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="orderIntEvents" value="Integration Events&#xa;OrderSubmittedIntegrationEvent" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=center;" vertex="1" parent="orderService">
          <mxGeometry x="20" y="140" width="250" height="40" as="geometry" />
        </mxCell>

        <mxCell id="orderSaga" value="OrderProcessingSaga" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="orderService">
          <mxGeometry x="20" y="200" width="250" height="40" as="geometry" />
        </mxCell>

        <!-- Message Bus -->
        <mxCell id="messageBus" value="" style="swimlane;fontStyle=1;align=center;verticalAlign=top;startSize=30;horizontal=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="420" y="100" width="200" height="280" as="geometry" />
        </mxCell>

        <mxCell id="busTitle" value="Message Bus&#xa;(RabbitMQ)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" vertex="1" parent="messageBus">
          <mxGeometry x="25" y="35" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="exchange" value="Exchange" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="messageBus">
          <mxGeometry x="60" y="85" width="80" height="50" as="geometry" />
        </mxCell>

        <mxCell id="orderQueue" value="order-events" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="messageBus">
          <mxGeometry x="30" y="160" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="inventoryQueue" value="inventory-events" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="messageBus">
          <mxGeometry x="110" y="160" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="sagaQueue" value="saga-events" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="messageBus">
          <mxGeometry x="60" y="210" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- Inventory Service Box -->
        <mxCell id="inventoryService" value="Inventory Service" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="680" y="100" width="280" height="280" as="geometry" />
        </mxCell>

        <mxCell id="inventoryAggregate" value="Product Aggregate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="inventoryService">
          <mxGeometry x="20" y="50" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="inventoryHandler" value="Event Handler&#xa;OrderSubmittedHandler" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=center;" vertex="1" parent="inventoryService">
          <mxGeometry x="150" y="50" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="inventoryIntEvents" value="Integration Events&#xa;InventoryReservedEvent&#xa;InventoryReservationFailedEvent" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=center;" vertex="1" parent="inventoryService">
          <mxGeometry x="20" y="120" width="250" height="60" as="geometry" />
        </mxCell>

        <mxCell id="inventoryCommand" value="ReserveInventoryCommand" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="inventoryService">
          <mxGeometry x="20" y="200" width="250" height="40" as="geometry" />
        </mxCell>

        <!-- Arrows between components -->
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="240" as="sourcePoint" />
            <mxPoint x="420" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow1Label" value="Publish" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="365" y="220" width="50" height="20" as="geometry" />
        </mxCell>

        <mxCell id="arrow2" value="" style="endArrow=classic;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="620" y="240" as="sourcePoint" />
            <mxPoint x="680" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow2Label" value="Subscribe" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="620" y="220" width="60" height="20" as="geometry" />
        </mxCell>

        <!-- Response flow -->
        <mxCell id="arrow3" value="" style="endArrow=classic;html=1;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="680" y="280" as="sourcePoint" />
            <mxPoint x="620" y="320" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow4" value="" style="endArrow=classic;html=1;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="420" y="320" as="sourcePoint" />
            <mxPoint x="360" y="300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow4Label" value="Response Event" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="460" y="330" width="100" height="20" as="geometry" />
        </mxCell>

        <!-- Saga State Store -->
        <mxCell id="sagaStore" value="Saga State Store&#xa;(MongoDB)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="160" y="430" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="sagaStoreArrow" value="" style="endArrow=classic;startArrow=classic;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="220" y="380" as="sourcePoint" />
            <mxPoint x="220" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sagaStoreLabel" value="Persist/Load State" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="225" y="395" width="90" height="20" as="geometry" />
        </mxCell>

        <!-- Flow Sequence Box -->
        <mxCell id="sequenceBox" value="Message Flow Sequence" style="swimlane;fontStyle=1;align=center;verticalAlign=top;startSize=26;horizontal=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="420" y="430" width="540" height="150" as="geometry" />
        </mxCell>

        <mxCell id="seq1" value="1. Order submitted → Publish OrderSubmittedIntegrationEvent" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;spacingLeft=10;" vertex="1" parent="sequenceBox">
          <mxGeometry y="30" width="540" height="20" as="geometry" />
        </mxCell>

        <mxCell id="seq2" value="2. Message bus routes to Inventory Service queue" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;spacingLeft=10;" vertex="1" parent="sequenceBox">
          <mxGeometry y="50" width="540" height="20" as="geometry" />
        </mxCell>

        <mxCell id="seq3" value="3. Inventory Service handles event → Reserves stock" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;spacingLeft=10;" vertex="1" parent="sequenceBox">
          <mxGeometry y="70" width="540" height="20" as="geometry" />
        </mxCell>

        <mxCell id="seq4" value="4. Publish InventoryReservedEvent (success) or InventoryReservationFailedEvent (failure)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;spacingLeft=10;" vertex="1" parent="sequenceBox">
          <mxGeometry y="90" width="540" height="20" as="geometry" />
        </mxCell>

        <mxCell id="seq5" value="5. Order Service Saga handles response → Updates state / Triggers compensation" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;spacingLeft=10;" vertex="1" parent="sequenceBox">
          <mxGeometry y="110" width="540" height="20" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend" value="Legend" style="swimlane;fontStyle=1;align=center;verticalAlign=top;startSize=26;horizontal=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1020" y="100" width="160" height="160" as="geometry" />
        </mxCell>

        <mxCell id="leg1" value="Aggregate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="legend">
          <mxGeometry x="10" y="35" width="65" height="25" as="geometry" />
        </mxCell>

        <mxCell id="leg2" value="Event" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="legend">
          <mxGeometry x="85" y="35" width="65" height="25" as="geometry" />
        </mxCell>

        <mxCell id="leg3" value="Saga" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;" vertex="1" parent="legend">
          <mxGeometry x="10" y="70" width="65" height="25" as="geometry" />
        </mxCell>

        <mxCell id="leg4" value="Handler" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="legend">
          <mxGeometry x="85" y="70" width="65" height="25" as="geometry" />
        </mxCell>

        <mxCell id="leg5" value="Command" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="legend">
          <mxGeometry x="10" y="105" width="65" height="25" as="geometry" />
        </mxCell>

        <mxCell id="leg6" value="Queue" style="shape=process;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="legend">
          <mxGeometry x="85" y="105" width="65" height="25" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
